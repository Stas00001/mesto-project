(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/plus-cohort-22",headers:{authorization:"a06d07f4-0395-4028-bda1-ecc0fed6969d","Content-Type":"application/json"}},t=function(e){return e.ok?e.json():Promise.reject("Error: ".concat(e.status))},n=function(){return fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t)},o=function(n){return fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then(t)},r=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then(t)},a=function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then(t)},c=document.querySelector('.popup__form[name="cards"]'),i=c.querySelector('.popup__input[name="nameCards"]'),u=c.querySelector('.popup__input[name="imageCards"]'),s=document.querySelector(".publications");function l(e){var t,c,i,u,s=document.querySelector("#cards").content.querySelector(".publications__card").cloneNode(!0),l=s.querySelector(".publications__title"),d=s.querySelector(".publications__image"),p=s.querySelector(".publications__btnlike"),m=s.querySelector(".publications__like");l.textContent=e.name,d.src=e.link,d.alt=e.name,t=e.likes.length;var _=e.likes;i=e._id,c=e.owner._id;var f=_.map((function(e){return e._id}));return s.querySelector("#like").innerHTML=t,t>0&&m.classList.add("publications__like_active"),n().then((function(e){f.includes(e._id)&&p.classList.add("publications__btnlike_active")})),s.addEventListener("click",(function(e){e.target.classList.contains("publications__btnlike")&&(e.target.classList.contains("publications__btnlike_active")?(t=(u=!1)?++t:--t,u=!u,e.target.classList.toggle("publications__btnlike_active"),a(i),s.querySelector("#like").innerHTML=t):(t=(u=!0)?++t:--t,u=!u,e.target.classList.toggle("publications__btnlike_active"),r(i),s.querySelector("#like").innerHTML=t),0===t&&e.target.classList.contains("publications__btnlike")&&m.classList.toggle("publications__like_active"))})),s.querySelector(".popup-open").addEventListener("click",(function(t){t.preventDefault(),h.src=e.link,S.textContent=e.name,h.alt=e.name,L(E)})),function(e,t,r){var a=e.querySelector(".publications__btndelete");n().then((function(n){t===n._id&&(a.classList.remove("publications__btndelete_inactive"),a.addEventListener("click",(function(t){e.remove(e),o(r)})))}))}(s,c,i),s}var d={formSelector:".form",inputSelector:".popup__input",submitButtonSelector:".popup__save-btn",inactiveButtonClass:"popup__save-btn_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"},p=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},m=function(e,t){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?p(e,t,d):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n,r.classList.add(o.errorClass)}(e,t,t.validationMessage,d)},_=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(n.inactiveButtonClass)):(t.disabled=!0,t.classList.add(n.inactiveButtonClass))};function f(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(n){return p(e,n,t)})),e.reset();var o=e.querySelector(t.submitButtonSelector);_(n,o,t)}var v=document.getElementById("formProfile"),y=document.getElementById("formAvatar"),b=document.getElementById("popup_profile"),h=(document.getElementById("popup_add"),document.querySelector(".popup__images")),S=document.querySelector(".popup__text"),E=document.getElementById("popup_image");function L(e){e.classList.add("popup_opened"),document.addEventListener("keydown",g),document.addEventListener("mousedown",k)}function q(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",g),document.removeEventListener("mousedown",k),f(c,d),f(v,d),f(y,d)}function g(e){"Escape"===e.key&&(e.preventDefault(),q(document.querySelector(".popup.popup_opened")))}function k(e){e.target.closest(".popup__body")||q(e.target.closest(".popup"))}var C=document.querySelector(".profile__avatar-image"),B=document.querySelectorAll(".popup__close-btn"),x=document.querySelector(".profile__btn_type_add"),A=document.querySelector(".profile__btn_type_edit"),T=document.getElementById("popup_add"),U=document.getElementById("avatar"),D=(document.getElementById("submitCard"),document.querySelector('.popup__input[name="name"]')),I=document.querySelector('.popup__input[name="job"]'),M=document.querySelector('.popup__input[name="avatar"]'),P=document.querySelector(".profile__name"),w=document.querySelector(".profile__about"),H=document.querySelector(".profile__avatar");fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).then((function(e){e.forEach((function(e){s.append(l(e))}))})),B.forEach((function(e){e.addEventListener("click",(function(e){q(e.currentTarget.closest(".popup"))}))})),x.addEventListener("click",(function(e){L(T)})),A.addEventListener("click",(function(e){var t,n;L(b),t=P,n=w,D.value=t.textContent,I.value=n.textContent})),H.addEventListener("click",(function(e){e.preventDefault(),L(U)})),n().then((function(e){P.textContent=e.name,w.textContent=e.about,C.src=e.avatar})),v.addEventListener("submit",(function(t){var n,o;t.preventDefault(),O(!0),P.textContent=D.value,w.textContent=I.value,(n=P,o=w,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:n.textContent,about:o.textContent})})).finally((function(){O(!1),q(b)}))})),c.addEventListener("submit",(function(n){n.preventDefault(),O(!0);var o,r,a={};a.name=i.value,a.link=u.value,(o=a.name,r=a.link,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:o,link:r})}).then(t)).then((function(e){s.prepend(l(e))})).finally((function(){O(!1),q(T)}))})),y.addEventListener("submit",(function(n){n.preventDefault(),O(!0);var o=M.value;C.src=o,function(n){return fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then(t)}(o).finally((function(){O(!1),q(U)}))}));var j=document.querySelectorAll(".loader"),N=document.querySelectorAll(".content");function O(e){e?(N.forEach((function(e){e.classList.add("loader_hidden")})),j.forEach((function(e){e.classList.add("loader_visible")}))):(N.forEach((function(e){e.classList.remove("loader_hidden")})),j.forEach((function(e){e.classList.remove("loader_visible")})))}!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);_(n,o,t),n.forEach((function(r){r.addEventListener("input",(function(){m(e,r),_(n,o,t)}))}))}(t,e)}))}(d)})();